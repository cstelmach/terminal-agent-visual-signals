#!/bin/bash
# ==============================================================================
# Terminal Agent Visual Signals - Global Configuration
# ==============================================================================
# This is the base configuration file. All agents inherit these defaults.
# Values here can be overridden by:
#   1. Agent-specific configs (claude.conf, gemini.conf, etc.)
#   2. User config (~/.terminal-visual-signals/user.conf)
#
# Configuration Priority: User > Agent > Global
# ==============================================================================

# ==============================================================================
# OPERATING MODE
# ==============================================================================
# Choose how colors are determined for visual signals.
#
# Options:
#   "static"  - Use hardcoded colors from this config (default)
#   "dynamic" - Query terminal background at session start, calculate colors
#               by hue-shifting while preserving saturation/lightness
#   "preset"  - Use a named theme preset from src/themes/
#
THEME_MODE="static"

# For THEME_MODE="preset", specify which preset to use
# Available presets: nord, dracula, solarized-dark, solarized-light, tokyo-night
# See src/themes/ for available presets or to add your own
THEME_PRESET=""

# ==============================================================================
# LIGHT/DARK MODE AUTO-DETECTION
# ==============================================================================
# Automatically detect system light/dark mode and adjust colors accordingly.
#
# When enabled, the system will:
#   1. Detect system preference (macOS: defaults read, Linux: gsettings)
#   2. Check at key events: SessionStart, Complete, Permission
#   3. Switch to light/dark color variants based on detection
#
# This works in combination with any THEME_MODE:
#   - static: Switches between DARK_* and LIGHT_* color sets
#   - dynamic: Uses detected mode to inform fallback behavior
#   - preset: Loads appropriate light/dark variant of preset
#
ENABLE_AUTO_DARK_MODE="false"

# Force a specific mode instead of auto-detecting
# Options: "auto" (detect), "dark" (force dark), "light" (force light)
FORCE_MODE="auto"

# ==============================================================================
# FEATURE TOGGLES
# ==============================================================================
# Master toggles for visual signal features

# Enable terminal background color changes
ENABLE_BACKGROUND_CHANGE="true"

# Enable terminal title/tab prefix updates
ENABLE_TITLE_PREFIX="true"

# Per-state toggles (set to "false" to disable specific states)
ENABLE_PROCESSING="true"
ENABLE_PERMISSION="true"
ENABLE_COMPLETE="true"
ENABLE_IDLE="true"
ENABLE_COMPACTING="true"

# ==============================================================================
# ANTHROPOMORPHISING (ASCII FACES)
# ==============================================================================
# Add expressive ASCII faces to terminal titles for personality.
#
# Master toggle
ENABLE_ANTHROPOMORPHISING="false"

# Face theme - determines the style of ASCII faces
# Available themes:
#   minimal - Simple kaomoji: (Â°-Â°) (Â°oÂ°) etc.
#   bear    - Bear faces: Ê•â€¢á´¥â€¢Ê” family
#   cat     - Cat faces: à¸…^â€¢ï»Œâ€¢^à¸… family
#   lenny   - Lenny faces: ( Í¡Â° ÍœÊ– Í¡Â°) family
#   shrug   - Shrug family: Â¯\_(ãƒ„)_/Â¯
#   plain   - ASCII-only for compatibility: :-) :| etc.
#   claudA  - Claude-branded face theme A
#   claudB  - Claude-branded face theme B
#   claudC  - Claude-branded face theme C
#   claudD  - Claude-branded face theme D
#   claudE  - Claude-branded face theme E
#   claudF  - Claude-branded face theme F
#
FACE_THEME="minimal"

# Where the face appears relative to the emoji
# Options: "before" or "after"
#   before: (Â°-Â°) ðŸŸ  ~/path
#   after:  ðŸŸ  (Â°-Â°) ~/path
FACE_POSITION="before"

# ==============================================================================
# COLORS - DARK MODE (Default)
# ==============================================================================
# Hex colors for each state. These are used when:
#   - THEME_MODE="static" and (FORCE_MODE="dark" or auto-detect returns dark)
#   - As fallback when dynamic mode fails
#
# Current palette: Catppuccin Frappe (muted tints)

# Base color (used for reset/idle final stage)
DARK_BASE="#2E3440"

# State colors
DARK_PROCESSING="#473D2F"   # Muted orange - agent is working
DARK_PERMISSION="#4A2021"   # Muted red - needs user approval
DARK_COMPLETE="#473046"     # Muted purple-green - response finished
DARK_IDLE="#443147"         # Muted purple - waiting for input
DARK_COMPACTING="#2B4645"   # Muted teal - context compression

# ==============================================================================
# COLORS - LIGHT MODE
# ==============================================================================
# Lighter variants for light terminal backgrounds.
# Used when ENABLE_AUTO_DARK_MODE="true" and system is in light mode.
#
# If you only set dark colors, the system can auto-generate light variants
# by adjusting lightness. Set these explicitly for precise control.

LIGHT_BASE="#ECEFF4"
LIGHT_PROCESSING="#F5E0D0"   # Warm cream-orange
LIGHT_PERMISSION="#F5D0D0"   # Soft pink-red
LIGHT_COMPLETE="#E0F0E0"     # Soft mint-green
LIGHT_IDLE="#E8E0F0"         # Soft lavender
LIGHT_COMPACTING="#D8F0F0"   # Soft cyan-teal

# ==============================================================================
# EMOJIS
# ==============================================================================
# Emoji indicators shown in terminal title/tab for each state

EMOJI_PROCESSING="ðŸŸ "
EMOJI_PERMISSION="ðŸ”´"
EMOJI_COMPLETE="ðŸŸ¢"
EMOJI_IDLE="ðŸŸ£"
EMOJI_COMPACTING="ðŸ”„"

# ==============================================================================
# DYNAMIC MODE SETTINGS
# ==============================================================================
# Settings for THEME_MODE="dynamic"

# Target hues for each state (degrees, 0-360)
# When dynamic mode is active, the terminal's background color is queried,
# then each state color is calculated by shifting to these target hues
# while preserving the original saturation and lightness.
#
# Default hues create recognizable, distinct states:
HUE_PROCESSING=30     # Orange
HUE_PERMISSION=0      # Red
HUE_COMPLETE=120      # Green
HUE_IDLE=270          # Purple
HUE_COMPACTING=180    # Teal

# Timeout for OSC 11 terminal background query (seconds)
# If terminal doesn't respond within this time, fallback to static colors
DYNAMIC_QUERY_TIMEOUT="0.1"

# Disable dynamic mode over SSH (recommended - can cause issues)
DYNAMIC_DISABLE_SSH="true"

# ==============================================================================
# IDLE TIMER CONFIGURATION
# ==============================================================================
# The idle timer creates a gradual fade from Complete state back to reset.
# Stages progress: Complete(0) -> Idle(1-5) -> Reset(6)

# Show stage indicators in title
ENABLE_STAGE_INDICATORS="true"

# Stage durations in seconds
# Format: Stage0 Stage1 Stage2 Stage3 Stage4 Stage5 Stage6
# Total time before full reset: sum of all durations
STAGE_DURATIONS=(60 30 30 30 30 30 30)

# Check interval in seconds (how often the timer checks for state changes)
IDLE_CHECK_INTERVAL=15

# ==============================================================================
# IDLE STAGE COLORS (Optional Overrides)
# ==============================================================================
# By default, idle stages interpolate from COMPLETE color toward BASE color.
# You can override individual stages here for precise control.
#
# Format: IDLE_STAGE_N_COLOR="#RRGGBB" (N = 0-6)
# Stage 0 = Complete, Stage 6 = Reset
#
# Leave commented to use automatic interpolation:
# IDLE_STAGE_0_COLOR=""  # Uses DARK/LIGHT_COMPLETE
# IDLE_STAGE_1_COLOR=""  # Uses DARK/LIGHT_IDLE
# IDLE_STAGE_2_COLOR=""
# IDLE_STAGE_3_COLOR=""
# IDLE_STAGE_4_COLOR=""
# IDLE_STAGE_5_COLOR=""
# IDLE_STAGE_6_COLOR=""  # Reset (uses terminal default)

# ==============================================================================
# IDLE STAGE EMOJIS (Optional Overrides)
# ==============================================================================
# By default stages use EMOJI_COMPLETE (stage 0), EMOJI_IDLE (stages 1-5),
# and empty (stage 6 = reset). Override for custom progression:
#
# IDLE_STAGE_0_EMOJI=""  # Uses EMOJI_COMPLETE
# IDLE_STAGE_1_EMOJI=""  # Uses EMOJI_IDLE
# IDLE_STAGE_2_EMOJI=""
# IDLE_STAGE_3_EMOJI=""
# IDLE_STAGE_4_EMOJI=""
# IDLE_STAGE_5_EMOJI=""
# IDLE_STAGE_6_EMOJI=""  # Empty (reset)

# ==============================================================================
# BELL/NOTIFICATION SETTINGS
# ==============================================================================
# Audio/visual bell for state changes (terminal-dependent)

ENABLE_BELL_PROCESSING="false"
ENABLE_BELL_PERMISSION="true"   # Bell when permission needed
ENABLE_BELL_COMPLETE="false"
ENABLE_BELL_COMPACTING="false"

# ==============================================================================
# ADVANCED SETTINGS
# ==============================================================================

# Debug logging (creates detailed logs in /tmp/terminal-visual-signals-debug/)
DEBUG_ALL="0"

# Idle timer debug logging
IDLE_DEBUG="0"

# State grace period in milliseconds
# Prevents rapid state changes from causing visual flickering
STATE_GRACE_PERIOD_MS=400

# ==============================================================================
# STYLISH BACKGROUNDS (Images)
# ==============================================================================
# Enable background images for supported terminals (iTerm2, Kitty only).
# Falls back silently to solid colors on unsupported terminals.
#
# IMPORTANT: This is an opt-in feature. Default is OFF.
#
# Requirements:
#   - iTerm2: No additional setup required
#   - Kitty: Requires allow_remote_control=yes in kitty.conf
#
# Other terminals (Terminal.app, Alacritty, GNOME Terminal, etc.):
#   Stylish backgrounds are not supported. The system will fall back to
#   solid colors without errors or warnings.

# Master toggle for stylish background images
# Set to "true" to enable background images (iTerm2/Kitty only)
ENABLE_STYLISH_BACKGROUNDS="false"

# Directory containing background images
# Structure can be flat or organized by dark/light mode:
#   Flat: backgrounds/processing.png, permission.png, etc.
#   Organized: backgrounds/dark/processing.png, backgrounds/light/processing.png
#
# Supported image formats: PNG (recommended), JPG
# Recommended resolution: Match your display (e.g., 1920x1080, 2560x1440)
STYLISH_BACKGROUNDS_DIR="$HOME/.terminal-visual-signals/backgrounds"

# Alternative: Use a single image for all states
# When set, this image is used if no state-specific image is found
# Leave empty to disable single-image fallback
STYLISH_SINGLE_IMAGE=""

# Disable stylish backgrounds over SSH (recommended for security)
STYLISH_DISABLE_SSH="true"

# Skip background color tint when background images are active
# When "true": Terminals that support background images (iTerm2, Kitty) will
#              only show the image, without the color tint overlay
# When "false": Both background image AND color tint are applied (default)
# Note: Terminals without image support (Ghostty, etc.) always get the color
STYLISH_SKIP_BG_TINT="false"

# ------------------------------------------------------------------------------
# iTerm2-Specific Settings
# ------------------------------------------------------------------------------
# These options only apply when running in iTerm2

# Image display mode (how image fills the terminal)
# Options: "default", "aspect_fill", "tile"
#   default     - Let iTerm2 decide (usually stretch)
#   aspect_fill - Scale to fill, maintaining aspect ratio (may crop)
#   tile        - Repeat the image as tiles
ITERM2_IMAGE_MODE="aspect_fill"

# ------------------------------------------------------------------------------
# Kitty-Specific Settings
# ------------------------------------------------------------------------------
# These options only apply when running in Kitty
# Note: Requires allow_remote_control=yes in kitty.conf

# Image layout mode
# Options: "scaled", "tiled", "mirrored", "clamped"
#   scaled  - Scale to fit terminal size
#   tiled   - Tile the image
#   mirrored - Tile with mirroring at edges
#   clamped - Clamp edges (extend edge pixels)
KITTY_IMAGE_LAYOUT="scaled"

# Background tint factor (0.0-1.0)
# Higher values add more tint/opacity for better text readability
# 0.0 = no tint (image fully visible)
# 1.0 = full tint (image barely visible)
# Recommended: 0.7-0.9 for readability with subtle background
KITTY_IMAGE_TINT="0.8"
